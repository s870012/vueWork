import{r as g,e as z,u as A,c as d,w as l,a as s,f as h,t as b,g as V,v as x,F as k,b as F,o as p,h as I}from"./index-CLPrgGHp.js";import{a as u}from"./index-NIGUFBhG.js";const L={class:"position-fixed top-25 end-0 p-3 rounded-2",style:{zIndex:"2000",backgroundColor:"#FFD370"}},M={class:"toast-body"},U={class:"container"},B={class:"row"},D={class:"col-10 mx-auto my-5"},N={class:"input-group my-3"},S={key:0,class:"text-center text-black-50"},j={class:"list-group"},G={class:"list-group-item d-flex align-items-center justify-content-between"},J={class:"input-group"},O=["onUpdate:modelValue","onChange"],R={key:0},H={class:"d-flex text-nowrap"},K=["onClick"],P=["onClick"],Q=["onClick"],W=["onClick"],tt={__name:"TodoView",setup(X){const r="https://todolist-api.hexschool.io/",_=A(),n=g({require:!1,text:""}),c=document.cookie.replace(/(?:^|.*;\s*)TodoToken\s*=\s*([^;]*).*$/i,"$1");z(async()=>{try{await u.get(`${r}users/checkout`,{headers:{Authorization:c}}),v(),n.value={require:!0,text:"登入成功!"},setTimeout(()=>{n.value.require=!1},1e3)}catch(e){console.log("錯誤",e),_.push("/signup")}});const a=g([]),v=async()=>{try{const e=await u.get(`${r}todos/`,{headers:{Authorization:c}});a.value=e.data.data.map(o=>({...o,isEdit:!1}))}catch(e){console.log(e)}},y=g({content:""}),f=async e=>{try{await u.post(`${r}todos/`,e,{headers:{Authorization:c}}),v(),e.content="",n.value={require:!0,text:"新增成功!"},setTimeout(()=>{n.value.require=!1},1e3)}catch(o){console.log(o)}},T=async e=>{try{await u.delete(`${r}todos/${e}`,{headers:{Authorization:c}}),v(),n.value={require:!0,text:"刪除成功!"},setTimeout(()=>{n.value.require=!1},1e3)}catch(o){console.log(o)}},m=g({content:""}),$=e=>{const o=a.value.findIndex(t=>t.id===e.id);a.value[o].isEdit=!0,m.value=e.content},C=async e=>{const o=a.value.findIndex(t=>t.id===e.id);a.value[o].content=m.value;try{await u.put(`${r}todos/${e.id}`,e,{headers:{Authorization:c}}),v(),n.value={require:!0,text:"編輯成功!"},setTimeout(()=>{n.value.require=!1},1e3)}catch(t){console.log(t)}},w=e=>{const o=a.value.findIndex(t=>t.id===e);a.value[o].isEdit=!1},q=async e=>{try{await u.patch(`${r}todos/${e.id}/toggle`,null,{headers:{Authorization:c}}),console.log("代辦事項完成")}catch(o){console.log(o)}},E=async()=>{try{await u.post(`${r}users/sign_out`,null,{headers:{Authorization:c}}),document.cookie="TodoToken=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",n.value={require:!0,text:"登出成功!"},setTimeout(()=>{n.value.require=!1},1e3),_.push("/")}catch(e){console.log(e)}};return(e,o)=>(p(),d(k,null,[l(s("div",L,[s("div",M,b(n.value.text),1)],512),[[h,n.value.require]]),s("div",U,[s("div",B,[s("div",D,[o[3]||(o[3]=s("h1",{class:"text-center"},"TodoList",-1)),s("button",{type:"button",class:"btn btn-primary d-block ms-auto",onClick:E}," 登出 "),s("div",N,[l(s("input",{type:"text",class:"form-control border-dark",placeholder:"新增代辦事項","onUpdate:modelValue":o[0]||(o[0]=t=>y.value.content=t)},null,512),[[x,y.value.content]]),s("button",{type:"button",class:"btn btn-dark px-5",onClick:o[1]||(o[1]=t=>f(y.value))}," 新增 ")]),a.value.length?V("",!0):(p(),d("h2",S,"無代辦事項")),(p(!0),d(k,null,F(a.value,t=>(p(),d("div",{key:t.id},[s("ul",j,[s("li",G,[s("div",J,[l(s("input",{class:"me-2",type:"checkbox","onUpdate:modelValue":i=>t.status=i,onChange:i=>q(t)},null,40,O),[[I,t.status]]),t.isEdit?l((p(),d("input",{key:1,type:"text","onUpdate:modelValue":o[2]||(o[2]=i=>m.value=i),class:"form-control me-1"},null,512)),[[x,m.value]]):(p(),d("span",R,b(t.content),1))]),s("div",H,[l(s("button",{type:"button",class:"btn btn-primary me-1",onClick:i=>$(t)}," 編輯 ",8,K),[[h,!t.isEdit]]),l(s("button",{type:"button",class:"btn btn-success me-1",onClick:i=>C(t)}," 確定 ",8,P),[[h,t.isEdit]]),l(s("button",{type:"button",class:"btn btn-danger",onClick:i=>w(t.id)}," 取消 ",8,Q),[[h,t.isEdit]]),l(s("button",{type:"button",class:"btn btn-danger",onClick:i=>T(t.id)}," 刪除 ",8,W),[[h,!t.isEdit]])])])])]))),128))])])])],64))}};export{tt as default};
